<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.sealin.net","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="不妄取, 不妄予, 不妄想, 不妄求;与人方便, 随遇而安。">
<meta property="og:type" content="website">
<meta property="og:title" content="Sealin">
<meta property="og:url" content="http://www.sealin.net/page/7/index.html">
<meta property="og:site_name" content="Sealin">
<meta property="og:description" content="不妄取, 不妄予, 不妄想, 不妄求;与人方便, 随遇而安。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Sealin">
<meta property="article:tag" content="技术, 生活, 随笔">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.sealin.net/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Sealin</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Sealin" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sealin</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">初闻不解词间意，再听已是曲中人。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/11/17/raspberry-arch-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/17/raspberry-arch-install/" class="post-title-link" itemprop="url">树莓派安装Arch Linux</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-17 22:44:15" itemprop="dateCreated datePublished" datetime="2019-11-17T22:44:15+08:00">2019-11-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%98%E8%85%BE%E5%AE%9E%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">折腾实录</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%98%E8%85%BE%E5%AE%9E%E5%BD%95/%E6%A0%91%E8%8E%93%E6%B4%BE/" itemprop="url" rel="index"><span itemprop="name">树莓派</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>因为前段时间调试树莓派拔了几次电源, 可能是有文件损坏, 直接不能开机了.<br>无奈只能考虑重新装下系统了, 官网的系统是带桌面的. 对树莓派来说资源有限, 桌面还是不要比较好.<br>于是考虑装个Arch, 一方面很干净, 另一方面社区支持很强大, 软件库很全.<br>以下是安装过程:</p>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><p>Arch的安装需要依赖Linux环境, 所以后续步骤都需要在Linux环境中进行. 由于我物理机是用的Windows, 所以要把SD卡加载到虚拟机中.</p>
<h1 id="虚拟机挂载SD卡"><a href="#虚拟机挂载SD卡" class="headerlink" title="虚拟机挂载SD卡:"></a>虚拟机挂载SD卡:</h1><h2 id="查看读卡器"><a href="#查看读卡器" class="headerlink" title="查看读卡器"></a>查看读卡器</h2><p>我是直接买的SD读卡器, 然后接到笔记本的读卡那个口的(不是USB).所以直接可移动设备这里是找不到这个SD卡的.<br><img src="/images/2019/11/17/d5f7b880-0940-11ea-b150-ff9e08d2dade.png" alt="image.png"><br>如果是通过USB读卡器可以跳过此步骤, 直接在<strong>虚拟机</strong> -&gt; <strong>可移动设备</strong>中连接设备就可以了.<br>正确的挂载方式:<br>在磁盘管理器(diskmgmt.msc)找到SD卡的编号, 如下图, 我的电脑是两个硬盘, 所以这里有磁盘0和磁盘1.如果已经插入SD卡, 会多出一个磁盘2, 确认一下磁盘2是你的SD卡, 弄错了后续操作会格式化掉选中的磁盘.<br><img src="/images/2019/11/17/45fd16c0-0941-11ea-b150-ff9e08d2dade.png" alt="image.png"></p>
<h2 id="添加到虚拟机"><a href="#添加到虚拟机" class="headerlink" title="添加到虚拟机"></a>添加到虚拟机</h2><p>注意, 此功能需要以管理员权限运行VMware<br>编辑虚拟机设置, 点击<strong>添加</strong><br><img src="/images/2019/11/17/004ae020-0942-11ea-b150-ff9e08d2dade.png" alt="image.png"><br>在弹出的窗口选择 硬盘 -&gt; IDE(据说SCSI也可以, 不过没测试过, 官方文档推荐的是IDE类型) -&gt; 使用物理磁盘 -&gt; 选择在上一步找到的设备编号, 如磁盘2, 下边的框选择整个磁盘<br>后续步骤填写保存的文件名即可.</p>
<h1 id="下载ArchARM镜像"><a href="#下载ArchARM镜像" class="headerlink" title="下载ArchARM镜像"></a>下载ArchARM镜像</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到下载路径(自定义)</span></span><br><span class="line"><span class="built_in">cd</span> /home/download</span><br><span class="line">wget http://os.archlinuxarm.org/os/ArchLinuxARM-rpi-3-latest.tar.gz</span><br><span class="line"><span class="comment"># 创建boot 和 root目录, 为安装做准备</span></span><br><span class="line"><span class="built_in">mkdir</span> boot root</span><br></pre></td></tr></table></figure>
<h1 id="SD卡分区"><a href="#SD卡分区" class="headerlink" title="SD卡分区"></a>SD卡分区</h1><p>将设备添加到虚机配置后, 运行虚拟机, 进入Linux环境.<br>本文以fdisk进行分区.</p>
<h2 id="查看SD卡设备"><a href="#查看SD卡设备" class="headerlink" title="查看SD卡设备"></a>查看SD卡设备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure>
<p>根据容量判断SD卡的设备名称, 如: &#x2F;dev&#x2F;sdb</p>
<h2 id="分区步骤"><a href="#分区步骤" class="headerlink" title="分区步骤:"></a>分区步骤:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载SD卡设备(以/dev/sdb为例, 如有差异自行修改)</span></span><br><span class="line">fdisk /dev/sdb</span><br><span class="line"><span class="comment"># 清空已有分区</span></span><br><span class="line">o</span><br><span class="line"><span class="comment"># 新建BOOT分区</span></span><br><span class="line">n</span><br><span class="line"><span class="comment"># 新建主分区(p)</span></span><br><span class="line">[ENTER]</span><br><span class="line"><span class="comment"># 选择分区1</span></span><br><span class="line">[ENTER]</span><br><span class="line"><span class="comment"># 直接回车, 使用默认起始扇区</span></span><br><span class="line">[ENTER]</span><br><span class="line"><span class="comment"># 将BOOT分区大小设置为200M</span></span><br><span class="line">+200M</span><br><span class="line"><span class="comment"># 设置分区格式为fat32</span></span><br><span class="line">t</span><br><span class="line">c</span><br><span class="line"><span class="comment"># 新建根分区</span></span><br><span class="line">n</span><br><span class="line">[ENTER]</span><br><span class="line">[ENTER]</span><br><span class="line">[ENTER]</span><br><span class="line">...一路回车(直到回到提示按m显示参数列表这里)</span><br><span class="line"><span class="comment"># 保存分区配置并退出</span></span><br><span class="line">w</span><br></pre></td></tr></table></figure>
<h2 id="格式化-amp-挂载分区"><a href="#格式化-amp-挂载分区" class="headerlink" title="格式化&amp;挂载分区"></a>格式化&amp;挂载分区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 格式化boot分区</span></span><br><span class="line">mkfs.vfat /dev/sdb1</span><br><span class="line"><span class="comment"># 格式化root分区</span></span><br><span class="line">mkfs.ext4 /dev/sdb2</span><br><span class="line"><span class="comment"># 挂载boot分区到boot目录</span></span><br><span class="line">mount /dev/sdb1 boot</span><br><span class="line"><span class="comment"># 挂载根分区到root目录</span></span><br><span class="line">mount /dev/sdb2 root</span><br></pre></td></tr></table></figure>
<h1 id="安装镜像文件"><a href="#安装镜像文件" class="headerlink" title="安装镜像文件"></a>安装镜像文件</h1><h2 id="导出镜像文件到root目录"><a href="#导出镜像文件到root目录" class="headerlink" title="导出镜像文件到root目录"></a>导出镜像文件到root目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bsdtar -xpf ArchLinuxARM-rpi-3-latest.tar.gz -C root</span><br><span class="line"><span class="built_in">sync</span></span><br></pre></td></tr></table></figure>
<p>如果报错: bsdtar: Error exit delayed from previous errors.升级一下bsdtar就可以了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/libarchive/libarchive/archive/v3.3.2.tar.gz</span><br><span class="line">tar xf v3.3.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libarchive-3.3.2</span><br><span class="line">cmake .</span><br><span class="line">make -j2</span><br></pre></td></tr></table></figure>
<h2 id="复制boot目录内的文件"><a href="#复制boot目录内的文件" class="headerlink" title="复制boot目录内的文件"></a>复制boot目录内的文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> root/boot/* boot</span><br></pre></td></tr></table></figure>
<h2 id="卸载分区"><a href="#卸载分区" class="headerlink" title="卸载分区"></a>卸载分区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount boot root</span><br></pre></td></tr></table></figure>
<h1 id="后续操作-建议"><a href="#后续操作-建议" class="headerlink" title="后续操作(建议)"></a>后续操作(建议)</h1><p>在完成安装步骤后, 建议不要直接拔出SD卡, 可能造成文件丢失. 因为树莓派一般是没有显示器的, 如果不能启动调试起来很麻烦, 应尽量避免此类问题.</p>
<h2 id="关闭虚拟机"><a href="#关闭虚拟机" class="headerlink" title="关闭虚拟机"></a>关闭虚拟机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown -h now</span><br></pre></td></tr></table></figure>
<h2 id="物理机移除设备"><a href="#物理机移除设备" class="headerlink" title="物理机移除设备"></a>物理机移除设备</h2><p>如果是用windows, 在右下角跟U盘一样移除掉SD卡设备即可.</p>
<h1 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h1><p>ArchLinuxArm版本的默认用户密码都是alarm, 主机名也是alarm.如果不知道IP地址的可以试试主机名是否能找到.</p>
<p>到此树莓派的安装过程就结束了, 拔掉SD卡插回树莓派通电并插上网线, 后续有时间会分享更多树莓派实用玩法, 感谢关注.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/11/12/php-no-suffix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/12/php-no-suffix/" class="post-title-link" itemprop="url">Nginx+PHP实现无后缀访问</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-12 10:02:59" itemprop="dateCreated datePublished" datetime="2019-11-12T10:02:59+08:00">2019-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>其实这方面的资料在网上找了下不算多,但是也算很基本的东西吧,博主之前一直在思考能不能不通过服务器转发或者跳转就达到目的,也就是通过<a href="http://xxxx.com/test">http://xxxx.com/test</a> 这样的方式访问<a href="http://xxxx.com/test.php%E4%B9%8B%E7%B1%BB%E7%9A%84%E9%A1%B5%E9%9D%A2,%E6%9C%80%E5%88%9D%E5%B0%9D%E8%AF%95%E7%9B%B4%E6%8E%A5%E5%9C%A8php%E4%B8%AD%E5%AE%9E%E7%8E%B0,%E5%8F%91%E7%8E%B0php%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%98%AF%E4%B8%8D%E8%83%BD%E8%BF%99%E6%A0%B7%E8%A7%A3%E6%9E%90%E7%9A%84,%E5%9C%A8php%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E5%86%99%E4%B8%8A%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BC%9A%E5%AF%BC%E8%87%B4php-fpm%E7%9B%B4%E6%8E%A5%E6%8C%82%E6%8E%89">http://xxxx.com/test.php之类的页面,最初尝试直接在php中实现,发现php的配置文件是不能这样解析的,在php的配置文件中写上正则表达式会导致php-fpm直接挂掉</a>.<br>所以只能从nginx配置入手,nginx的配置文件是支持正则的,所以要么通过请求地址判断是否301转发,此外也可以在php的关联配置下新增一个配置组</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#这里写需要正常解析的后缀,这里加了解析类型后别忘了在php-fpm的配置文件中启用security.limit_extensions = .php .php7</span><br><span class="line">location ~ (.php7|.php)$ &#123;</span><br><span class="line">    root           html;</span><br><span class="line">    fastcgi_pass   <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9000</span>;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME  /$document_root$fastcgi_script_name;</span><br><span class="line">    include        fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line">#这里为新增的解析类型,如果需要准确匹配可以自行修改正则,此处为示例,解析除上述配置外的所有文件类型,也包括无后缀文件</span><br><span class="line">location ~ $ &#123;</span><br><span class="line">    root           html;</span><br><span class="line">    fastcgi_pass   <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9000</span>;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME  /$document_root$fastcgi_script_name.php;</span><br><span class="line">    include        fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经测试这样是可行的<br><img src="/images/2019/11/12/57f493d0-04f0-11ea-a4e8-15b79e6f3bf7.png" alt="image.png"><br>当然也可以通过301转向实现.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/09/29/docker-private-repository/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/29/docker-private-repository/" class="post-title-link" itemprop="url">Docker私有仓库搭建指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-29 21:26:21" itemprop="dateCreated datePublished" datetime="2019-09-29T21:26:21+08:00">2019-09-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" itemprop="url" rel="index"><span itemprop="name">环境配置</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">私有仓库</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h1><p>docker官方已经贴心的准备了一个私服镜像: registry, 所以我们直接拉下来启动就可以了.<br>官方镜像默认使用5000端口作为http服务启动端口, 所以我们要使用私服, 需要将5000转发到宿主机.<br>到这一步以后有一个坑, 启动容器并且转发端口后发现可以通过curl等工具进行请求访问, 但是无法push镜像进去. 是因为容器默认只接受https协议的push请求, 要允许http协议进行提交, 需要进行配置docker启动参数.<br>以下是搭建过程.</p>
<h1 id="获取镜像"><a href="#获取镜像" class="headerlink" title="获取镜像"></a>获取镜像</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure>

<h1 id="配置允许http提交镜像"><a href="#配置允许http提交镜像" class="headerlink" title="配置允许http提交镜像"></a>配置允许http提交镜像</h1><h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加如下内容:</span></span><br><span class="line"><span class="comment"># 192.168.1.100:5000替换为宿主机 IP:端口</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;insecure-registries&quot;</span>:[<span class="string">&quot;192.168.1.100:5000&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="重启Docker"><a href="#重启Docker" class="headerlink" title="重启Docker"></a>重启Docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure>

<h1 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name reg -p 5000:5000 registry</span><br></pre></td></tr></table></figure>

<h1 id="推送镜像到私服"><a href="#推送镜像到私服" class="headerlink" title="推送镜像到私服"></a>推送镜像到私服</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取任意一个镜像做测试, 也可以用registry</span></span><br><span class="line">docker pull hello-world</span><br><span class="line"><span class="comment"># 为hello-world镜像打上私服tag</span></span><br><span class="line">docker tag hello-world 192.168.1.100:5000/hello-world:1.0</span><br><span class="line"><span class="comment"># 推送</span></span><br><span class="line">docker push 192.168.1.100:5000/hello-world:1.0</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/09/12/docker-consul/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/12/docker-consul/" class="post-title-link" itemprop="url">单实例Docker部署Consul集群</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-12 21:31:30" itemprop="dateCreated datePublished" datetime="2019-09-12T21:31:30+08:00">2019-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">微服务</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" itemprop="url" rel="index"><span itemprop="name">注册中心</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="获取consul镜像"><a href="#获取consul镜像" class="headerlink" title="获取consul镜像"></a>获取consul镜像</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull consul</span><br></pre></td></tr></table></figure>

<h1 id="运行Consul服务"><a href="#运行Consul服务" class="headerlink" title="运行Consul服务"></a>运行Consul服务</h1><p>单机部署Docker内已实现互通, 不用人为干预通信端口转发, 启动后地址为172.17.0.2, 172.17.0.3 …. 只需要将8500端口转发出来即可.<br>多机部署需要将Consul需要的端口转发到宿主机, 以下是Consul运行用到的端口</p>
<table>
<thead>
<tr>
<th>端口</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>8300</td>
<td>8300 端口用于服务器节点。客户端通过该端口 RPC 协议调用服务端节点。服务器节点之间相互调用</td>
</tr>
<tr>
<td>8301</td>
<td>8301 端口用于单个数据中心所有节点之间的互相通信，即对 LAN 池信息的同步。它使得整个数据中心能够自动发现服务器地址，分布式检测节点故障，事件广播（如领导选举事件）。</td>
</tr>
<tr>
<td>8302</td>
<td>8302 端口用于单个或多个数据中心之间的服务器节点的信息同步，即对 WAN 池信息的同步。它针对互联网的高延迟进行了优化，能够实现跨数据中心请求。</td>
</tr>
<tr>
<td>8500</td>
<td>8500 端口基于 HTTP 协议，用于 API 接口或 WEB UI 访问。</td>
</tr>
<tr>
<td>8600</td>
<td>8600 端口作为 DNS 服务器，它使得我们可以通过节点名查询节点信息。</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 任选一个服务打开Web管理界面</span></span><br><span class="line">docker run -d --name consul1 -p 8500:8500 -e CONSUL_BIND_INTERFACE=eth0 consul agent --node=node1 --server=<span class="literal">true</span> --bootstrap-expect=3 --client=0.0.0.0 -ui</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将后续打开的服务加入集群</span></span><br><span class="line">docker run -d --name consul2 -e CONSUL_BIND_INTERFACE=eth0 consul agent --node=node2 --server=<span class="literal">true</span> --client=0.0.0.0 --<span class="built_in">join</span> 172.17.0.2</span><br><span class="line">docker run -d --name consul3 -e CONSUL_BIND_INTERFACE=eth0 consul agent --node=node3 --server=<span class="literal">true</span> --client=0.0.0.0 --<span class="built_in">join</span> 172.17.0.2</span><br></pre></td></tr></table></figure>
<h1 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h1><p>控制台地址: <a href="http://ip:8500/">http://IP:8500</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/08/15/SpringBoot-Nacos-SpringCloud/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/15/SpringBoot-Nacos-SpringCloud/" class="post-title-link" itemprop="url">SpringBoot+SpringCloud+Nacos</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-15 21:37:14" itemprop="dateCreated datePublished" datetime="2019-08-15T21:37:14+08:00">2019-08-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Nacos是阿里巴巴开源的一个注册中心和配置中心组件, 并且配置中心和注册中心可以单独导入项目, 只用其中一个.结合Spring Cloud可以实现与项目的高度融合, 配置支持多种格式, 可以轻松将项目配置从本地转到服务器, 集群搭建也非常简单.<br>在线配置结合nacos的命名空间功能, 轻松实现多环境切换, 完美~<br>本文使用的SpringBoot版本为: 2.1.7.RELEASE</p>
<h1 id="Nacos-安装与启动"><a href="#Nacos-安装与启动" class="headerlink" title="Nacos 安装与启动"></a>Nacos 安装与启动</h1><p>参考: <a href="https://nacos.io/zh-cn/docs/quick-start.html">官方文档</a><br>启动后默认端口为8848(钛合金手机?)<br>管理页面:<br><a href="http://localhost:8848/nacos">http://localhost:8848/nacos</a></p>
<h1 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h1><p>无需单独引入Spring Cloud依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        配置中心--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--        注册中心--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h1><pre><code>bootstrap.yml
注意文件名是bootstrap*, 试过使用application.yml启动会报错.
</code></pre>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># 程序的name与配置中心生成DataId有关, 避免出现问题建议配置此项</span></span><br><span class="line">    <span class="comment"># 配置中心的DataId可以理解为配置文件名称</span></span><br><span class="line">    <span class="comment"># 默认生成规则: $&#123;spring.application.name&#125;-$&#123;spring.profile.active&#125;.$&#123;file-extension&#125;</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nacos-demo</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="comment"># 注册中心</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.129</span><span class="string">:8848</span></span><br><span class="line">      <span class="comment"># 配置中心</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.129</span><span class="string">:8848</span></span><br><span class="line">        <span class="comment"># 配置文件后缀. 默认为.properties</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line">        <span class="comment"># 需要加载的其他配置dataId, 多个以英文逗号隔开</span></span><br><span class="line">        <span class="attr">shared-dataids:</span> <span class="string">common.yml,</span> <span class="string">redis.yml,</span> <span class="string">mysql.yml</span></span><br><span class="line">        <span class="comment"># 线上配置修改后需要自动刷新的配置</span></span><br><span class="line">        <span class="attr">refreshable-dataids:</span> <span class="string">common.yml,</span> <span class="string">redis.yml,</span> <span class="string">mysql.yml</span></span><br></pre></td></tr></table></figure>

<h1 id="使用在线配置"><a href="#使用在线配置" class="headerlink" title="使用在线配置"></a>使用在线配置</h1><p>到nacos控制台添加一个配置文件, 上文已配置了加载common.yml, 以此名称为例:<br><img src="/images/2019/08/15/9a2f2c30-bf5c-11e9-ae6a-b52e335d1f68.png" alt="image.png"><br>保存后添加一个Controller, 用于读取在线配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sealin.nacos.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.context.config.annotation.RefreshScope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sealin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-08-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">// 使用Spring Cloud提供的注解开启配置刷新支持</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(value = &quot;$&#123;age&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动项目后访问<a href="http://localhost:8080/">http://localhost:8080</a>, 发现已经读取到了在线配置</p>
<h1 id="多环境配置"><a href="#多环境配置" class="headerlink" title="多环境配置"></a>多环境配置</h1><p>结合Spring读取配置文件的规则, 结合nacos配置中心的命名空间, 可以为不同环境的项目加载对应环境的配置文件.<br>到管理页面添加命名空间:<br><img src="/images/2019/08/15/efb37c30-bf5a-11e9-ae6a-b52e335d1f68.png" alt="image.png"><br>框选的部分为产生的命名空间ID, 项目配置文件中用这个ID去指定命名空间, 写命名空间名称是行不通滴~</p>
<pre><code>bootstrap-test.yml
</code></pre>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">	<span class="comment"># 命名空间的值要写nacos生成的ID</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">141c776d-9524-4d84-a70d-9df2ea547708</span></span><br></pre></td></tr></table></figure>
<p>此时将spring的启动参数中指定启动环境为test, springboot则会在读取bootstrap.yml后, 读取bootstrap-test.yml文件, 此时nacos配置中心的命名空间就指向了test<br><img src="/images/2019/08/15/50919520-bf5e-11e9-ae6a-b52e335d1f68.png" alt="image.png"><br>重新运行项目, 错误信息如下:</p>
<pre><code>Caused by: java.lang.IllegalArgumentException: Could not resolve placeholder &#39;age&#39; in value &quot;$&#123;age&#125;&quot;
</code></pre>
<p>因为test命名空间下我们没有配置age这个key, 要屏蔽错误也比较简单, 可以在@Value注解中添加一个默认值, 在没有读取到在线配置时, 将显示此属性, 注册中心存在指定配置key时将获取线上配置:</p>
<pre><code>@Value(value = &quot;$&#123;age:10&#125;&quot;)
</code></pre>
<h1 id="注册中心"><a href="#注册中心" class="headerlink" title="注册中心"></a>注册中心</h1><h2 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h2><p>由于上文我们将环境切换到了测试环境, 项目启动时会读取nacos&#x2F;appname-test.yml配置, 根据这个特性, 到nacos控制台在test命名空间下添加一个配置文件, 用于指定服务注册的命名空间<br><img src="/images/2019/08/16/c1fcbaf0-bfcc-11e9-8866-5302bf177721.png" alt="image.png"></p>
<pre><code>nacos-demo-test.yml
</code></pre>
<p>内容如下:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">141c776d-9524-4d84-a70d-9df2ea547708</span></span><br></pre></td></tr></table></figure>

<p>在应用启动类上加入</p>
<pre><code>@EnableDiscoveryClient
</code></pre>
<p>此时去nacos控制台上查看, 会发现服务已经被注册到test命名空间了.<br><img src="/images/2019/08/15/c18a5ea0-bf5f-11e9-ae6a-b52e335d1f68.png" alt="image.png"></p>
<h2 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h2><h3 id="LoadBalance"><a href="#LoadBalance" class="headerlink" title="LoadBalance"></a>LoadBalance</h3><p>注册一个RestTemplate实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sealin.nacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sealin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosApplication</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(NacosApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>添加消费方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/lb&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">loadBalance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> restTemplate.getForObject(<span class="string">&quot;http://nacos-demo/&quot;</span>, String.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问<a href="http://localhost:8080/lb">http://localhost:8080/lb</a>, 结果与<a href="http://localhost:8080/%E4%B8%80%E8%87%B4">http://localhost:8080/一致</a></p>
<h3 id="OpenFeign"><a href="#OpenFeign" class="headerlink" title="OpenFeign"></a>OpenFeign</h3><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在启动类上开启Feign功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sealin.nacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sealin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NacosApplication</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(NacosApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加映射接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> net.sealin.nacos.controller.mapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sealin</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-08-14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;nacos-demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">INacosDemoMapping</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    String <span class="title function_">get</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加消费方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> INacosDemoMapping nacosDemoMapping;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/feign&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">feignRequest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> nacosDemoMapping.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问<a href="http://localhost:8080/feign">http://localhost:8080/feign</a>, 结果与&#x2F;lb一致</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/08/09/idea-devtool/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/09/idea-devtool/" class="post-title-link" itemprop="url">解决Spring Boot在IDEA中热部署失效的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-09 19:49:29" itemprop="dateCreated datePublished" datetime="2019-08-09T19:49:29+08:00">2019-08-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/%E7%BB%8F%E9%AA%8C/" itemprop="url" rel="index"><span itemprop="name">经验</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在IDEA中开发Spring Boot应用, 添加了spring-boot-devtools依赖发现热部署实际上并没有生效, 原因是IDEA代码自动保存后并没有触发编译.<br>知道问题后解决也简单, 完整步骤如下:</p>
<h1 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="配置依赖"><a href="#配置依赖" class="headerlink" title="配置依赖"></a>配置依赖</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="IDEA-配置"><a href="#IDEA-配置" class="headerlink" title="IDEA 配置"></a>IDEA 配置</h1><h2 id="自动编译"><a href="#自动编译" class="headerlink" title="自动编译"></a>自动编译</h2><p>配置路径:</p>
<blockquote>
<p>File -&gt; Settings -&gt; Compiler<br>勾选自动编译选项</p>
</blockquote>
<p><img src="/images/2019/08/09/eaf622c0-ba9a-11e9-82e8-e18e6cf7ed07.png" alt="image.png"></p>
<h2 id="修改IDEA行为"><a href="#修改IDEA行为" class="headerlink" title="修改IDEA行为"></a>修改IDEA行为</h2><p>查找行为(默认快捷键 CTRL + SHIFT + A), 查找</p>
<blockquote>
<p>Registry</p>
</blockquote>
<p><img src="/images/2019/08/09/5ad3d4c0-ba9b-11e9-82e8-e18e6cf7ed07.png" alt="image.png"><br>找到以下选项, 勾选(立即生效)</p>
<blockquote>
<p>compiler.automake.allow.when.app.running</p>
</blockquote>
<p>配置完成</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/07/30/GOF-0-Design-Patterns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/30/GOF-0-Design-Patterns/" class="post-title-link" itemprop="url">GOF设计模式及类型简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-30 10:02:44" itemprop="dateCreated datePublished" datetime="2019-07-30T10:02:44+08:00">2019-07-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BB%8F%E9%AA%8C/" itemprop="url" rel="index"><span itemprop="name">经验</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/%E7%BB%8F%E9%AA%8C/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="设计模式简介"><a href="#设计模式简介" class="headerlink" title="设计模式简介"></a>设计模式简介</h1><p>设计模式（Design pattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。</p>
<p>设计模式是一套被反复使用的、多数人知晓的、经过分类编目的、代码设计经验的总结。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。 </p>
<h1 id="设计模式总览"><a href="#设计模式总览" class="headerlink" title="设计模式总览"></a>设计模式总览</h1><div class="doc">

<table>
<thead>
<tr>
<th align="center">序号</th>
<th align="center">类型 &amp; 描述</th>
<th align="center">包括的模式</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">创建型模式</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">这些设计模式提供了一种在创建对象的同时<br>隐藏创建逻辑的方式，而不是使用 new<br>运算符直接实例化对象。这使得程序在<br>判断针对某个给定实例需要创建哪些对<br>象时更加灵活。</td>
<td align="center">工厂模式（Factory Pattern）<hr />抽象工厂模式（Abstract Factory Pattern）<hr />单例模式（Singleton Pattern）<hr />建造者模式（Builder Pattern）<hr />原型模式（Prototype Pattern）</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">结构型模式</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">这些设计模式关注类和对象的组合。继承<br>的概念被用来组合接口和定义组合对象<br>获得新功能的方式。</td>
<td align="center"><hr />适配器模式（Adapter Pattern）<hr />桥接模式（Bridge Pattern）<hr />过滤器模式（Filter、Criteria Pattern）<hr />组合模式（Composite Pattern）<hr />装饰器模式（Decorator Pattern）<hr />外观模式（Facade Pattern）<hr />享元模式（Flyweight Pattern）<hr />代理模式（Proxy Pattern）</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">行为型模式</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center">这些设计模式特别关注对象之间的通信。</td>
<td align="center">责任链模式（Chain of Responsibility Pattern）<hr />命令模式（Command Pattern）<hr />解释器模式（Interpreter Pattern）<hr />迭代器模式（Iterator Pattern）<hr />中介者模式（Mediator Pattern）<hr />备忘录模式（Memento Pattern）<hr />观察者模式（Observer Pattern）<hr />状态模式（State Pattern）<hr />空对象模式（Null Object Pattern）<hr />策略模式（Strategy Pattern）<hr />模板模式（Template Pattern）<hr />访问者模式（Visitor Pattern）</td>
</tr>
</tbody></table>
</div>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>设计模式总共可分为三大类: <strong>创建型</strong> &#x2F; <strong>结构型</strong> &#x2F; <strong>行为型</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/07/28/spring-aop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/28/spring-aop/" class="post-title-link" itemprop="url">Spring boot 使用AOP对方法进行增强和统一异常处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-28 01:28:46" itemprop="dateCreated datePublished" datetime="2019-07-28T01:28:46+08:00">2019-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="声明切入点"><a href="#声明切入点" class="headerlink" title="声明切入点"></a>声明切入点</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopPointCut</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 切入点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void net.sealin.web.demo.behavior.aop.bean.AopCalc.calcDiv(int, int))&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意类上声明的@Aspect注解<br>execution表达式的值为方法完整签名. 任何位置都可以使用通配符(*)替换, 比如上述表达式只为calcDiv()方法进行拦截, 如果改为如下形式, 将代理指定类中的所有方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(void net.sealin.web.demo.behavior.aop.bean.AopCalc.*(..))&quot;)</span></span><br></pre></td></tr></table></figure>
<p>改为如下形式, 将代理指定包和所有子包下的所有方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* net.sealin.web.demo.behavior.aop.bean..*.*(..))&quot;)</span></span><br></pre></td></tr></table></figure>
<p>如果还有不明白的地方请查找 pointcut execution 相关资料进行深入理解。</p>
<h1 id="注册到容器"><a href="#注册到容器" class="headerlink" title="注册到容器"></a>注册到容器</h1><p>可以在配置类中使用@Bean注解手动将切面类加入容器, 或者标记为@Component扫描此包路径</p>
<h1 id="方法增强"><a href="#方法增强" class="headerlink" title="方法增强"></a>方法增强</h1><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>在切面类中加入对应时机的处理方法, 可以实现目标方法的增强.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@After(value = &quot;pointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;@After 被执行了&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="支持的注解"><a href="#支持的注解" class="headerlink" title="支持的注解"></a>支持的注解</h2><table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Before</td>
<td>方法执行前调用</td>
</tr>
<tr>
<td>@After</td>
<td>方法执行后调用</td>
</tr>
<tr>
<td>@AfterReturning</td>
<td>方法返回后调用</td>
</tr>
<tr>
<td>@AfterThrowing</td>
<td>方法抛出异常后调用</td>
</tr>
<tr>
<td>@Around</td>
<td>方法环绕, 全权接管目标方法的调用过程</td>
</tr>
</tbody></table>
<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><p>想通过AOP实现全局异常处理, 使用@Around并且将调用过程用try-catch包裹即可.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;@Around 开始&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;@Around 结束&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;异常已被拦截, 异常信息为: %s&quot;</span>, throwable.getMessage()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="获取方法信息"><a href="#获取方法信息" class="headerlink" title="获取方法信息"></a>获取方法信息</h2><p>执行时机的方法声明时, 可以声明一个JoinPoint类型的入参, 此对象中包含方法调用的很多属性, 包括参数, 调用类型, 调用目标等等, 具体输出结果如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">getKind: method-execution</span><br><span class="line">getSingnature: <span class="keyword">void</span> net.sealin.web.demo.behavior.aop.bean.AopCalc.calcDiv(<span class="type">int</span>,<span class="type">int</span>)</span><br><span class="line">getSourceLocation: org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint$SourceLocationImpl@3e27aa33</span><br><span class="line">getStaticPart: execution(<span class="keyword">void</span> net.sealin.web.demo.behavior.aop.bean.AopCalc.calcDiv(<span class="type">int</span>,<span class="type">int</span>))</span><br><span class="line">getTarget: net.sealin.web.demo.behavior.aop.bean.AopCalc@2e385cce</span><br><span class="line">getThis: net.sealin.web.demo.behavior.aop.bean.AopCalc@2e385cce</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/07/23/log4jdbc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/23/log4jdbc/" class="post-title-link" itemprop="url">使用log4jdbc查看带参数的完整SQL语句</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-23 16:35:07" itemprop="dateCreated datePublished" datetime="2019-07-23T16:35:07+08:00">2019-07-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%80%E6%9C%AF/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一般情况下日志中的SQL语句参数都是以占位符(?)进行显示, 配置参数打印后也不能打印出完整的SQL, 而是把参数在SQL语句后单独打印出来, 这样难免要跟踪SQL的时候会非常麻烦, log4jdbc可以完美的帮我们解决上述的烦恼, 并且整合起来也非常简单.</p>
<h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.googlecode.log4jdbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="修改数据库连接"><a href="#修改数据库连接" class="headerlink" title="修改数据库连接"></a>修改数据库连接</h2><h3 id="Driver"><a href="#Driver" class="headerlink" title="Driver"></a>Driver</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一般配置</span></span><br><span class="line"><span class="string">jdbc.driver=oracle.jdbc.driver.OracleDriver</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改为如下配置:</span></span><br><span class="line"><span class="string">jdbc.driver=net.sf.log4jdbc.DriverSpy</span></span><br></pre></td></tr></table></figure>
<h3 id="Url"><a href="#Url" class="headerlink" title="Url"></a>Url</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一般配置</span></span><br><span class="line"><span class="string">jdbc.url=jdbc:oracle:thin:@localhost:1521:orcl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改为如下配置</span></span><br><span class="line"><span class="string">jdbc.url=jdbc:log4jdbc:oracle:thin:@localhost:1521:orcl</span></span><br></pre></td></tr></table></figure>
<h2 id="配置完成"><a href="#配置完成" class="headerlink" title="配置完成"></a>配置完成</h2><p>此时启动项目, 可以发现在执行sql时已经可以输出SQL执行的相关信息了, 但是输出了很多跟踪信息&#x2F;数据明细等日志, 这些东西可能又不是我们需要的, 例如我们只需要查看SQL, 那这些信息无疑是画蛇添足, 下边咱们来优化一波.</p>
<h2 id="支持的配置"><a href="#支持的配置" class="headerlink" title="支持的配置"></a>支持的配置</h2><table>
<thead>
<tr>
<th>logger</th>
<th>描述</th>
<th>since</th>
</tr>
</thead>
<tbody><tr>
<td>jdbc.sqlonly</td>
<td>仅仅记录 SQL 语句，会将占位符替换为实际的参数</td>
<td>1.0</td>
</tr>
<tr>
<td>jdbc.sqltiming</td>
<td>包含 SQL 语句实际的执行时间</td>
<td>1.0</td>
</tr>
<tr>
<td>jdbc.audit</td>
<td>除了 ResultSet 之外的所有JDBC调用信息，篇幅较长</td>
<td>1.0</td>
</tr>
<tr>
<td>jdbc.resultset</td>
<td>包含 ResultSet 的信息，输出篇幅较长</td>
<td>1.0</td>
</tr>
<tr>
<td>jdbc.connection</td>
<td>输出了 Connection 的 open、close 等信息</td>
<td>1.2alpha1</td>
</tr>
</tbody></table>
<h2 id="优化输出格式"><a href="#优化输出格式" class="headerlink" title="优化输出格式"></a>优化输出格式</h2><p>既然咱们只想看SQL语句, 那从上表可以看出sqlonly这种模式正是我们需要的, 其他的选项log4jdbc默认是打开的, 我们将之关闭就可以了, 配置如下.</p>
<h3 id="logback配置"><a href="#logback配置" class="headerlink" title="logback配置"></a>logback配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.sqlonly&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.audit&quot;</span> <span class="attr">level</span>=<span class="string">&quot;OFF&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.sqltiming&quot;</span> <span class="attr">level</span>=<span class="string">&quot;OFF&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.connection&quot;</span> <span class="attr">level</span>=<span class="string">&quot;OFF&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.resultset&quot;</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="log4j配置"><a href="#log4j配置" class="headerlink" title="log4j配置"></a>log4j配置</h3><p>既然知道了配置格式, log4j也就大同小异了</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">log4j.logger.jdbc.resultset=OFF</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>这样配置后输出的日志中就只有SQL信息了</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.sealin.net/2019/07/19/Jenkins-Proxy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sealin">
      <meta itemprop="description" content="不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sealin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/19/Jenkins-Proxy/" class="post-title-link" itemprop="url">Jenkins+Nginx 反向代理错误</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-19 11:03:51" itemprop="dateCreated datePublished" datetime="2019-07-19T11:03:51+08:00">2019-07-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-23 09:43:32" itemprop="dateModified" datetime="2023-05-23T09:43:32+08:00">2023-05-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/%E7%BB%8F%E9%AA%8C/" itemprop="url" rel="index"><span itemprop="name">经验</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在nginx中配置Jenkins服务代理规则, 将请求头转发到Jenkins服务器即可.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name jenkins.mydomain.com;</span><br><span class="line">  location / &#123;</span><br><span class="line">    proxy_pass http://jenkins.localnet:8080;</span><br><span class="line">    proxy_read_timeout  90;</span><br><span class="line">    proxy_set_header X-Forwarded-Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Server <span class="variable">$host</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Sealin</p>
  <div class="site-description" itemprop="description">不妄取, 不妄予, 不妄想, 不妄求;<br>与人方便, 随遇而安。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">76</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sealin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
